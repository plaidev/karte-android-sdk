apply plugin: "jacoco"

tasks.withType(Test) {
    jacoco.includeNoLocationClasses = true
    jacoco.excludes = ['jdk.internal.*']
}

jacoco {
    // 0.8.11+ required for Java 21 support (class file major version 65)
    toolVersion = "0.8.12"
}

task jacocoTestReport(
        type: JacocoReport,
        dependsOn: "testDebugUnitTest",
        group: "verification"
) {
    reports {
        xml.required = true
        html.required = true
    }
    getSourceDirectories().from = "${projectDir}/src/main/java"
    getClassDirectories().from = files(
            fileTree(dir: "${buildDir}/tmp/kotlin-classes/debug"),
            fileTree(dir: "${buildDir}/intermediates/javac/debug/classes/"))

    getExecutionData().from = "${buildDir}/jacoco/testDebugUnitTest.exec"
}
